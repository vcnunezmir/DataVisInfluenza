<!DOCTYPE html>
<html> 

<head>
	<script src='https://d3js.org/d3.v4.min.js'></script>
	<script src='https://d3js.org/topojson.v2.min.js'></script>
</head>
 <style>
.states {
  fill: #ccc;
  stroke: #fff;
}

.jumbotron{
	background-color:#F5F5DC;
	color:white;
}

#jumTitle{
	background-color:#E9967A;
	color:white;
}


#mid{
	background-color:#FAFAD2;
}

#bar{
	background-color:#FAFAD2;
}


#conclusion{
	background-color:#87CEFA;
	color:white;
}
#title{
font-size: 6em;
font-family:'Bungee';
color:#8B0000;
}

</style>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href='//fonts.googleapis.com/css?family=Bungee' rel='stylesheet'>
<body>

<div class = "container">
<div class = "page-hear" align="center">
<div id="jumTitle" class="jumbotron" align="center">

<span id="title">Influenza Spread</span>

</div>

<div class="jumbotron" align="center" >
<p>
This first graphic is an map of the US. The dots signify an influenza infection within that state, and the size denotes the quantity of infections. As we will see in other graphics, black denotes Human, blue denotes Mammalian, and red indicates Avian. The intention behind this graphic was to show the spread of influenza across the US. It is immediately noticeable that there seem to be clusters of influenza outbreaks for the different hosts, and very little connection between outbreaks in one host and outbreaks in another host. This leads to the question of why these outbreaks are clustering geographically.
</p>
<form id="clearButton" >
<button onclick="clear()">Clear filter</button>  
</form>
<div class="jumbotron" align="center" id="map">

</div>

<p>
A look into the rate of infections over two years shows that for humans and birds, there is a clear connection between seasons and influenza outbreaks. The lack of a season for non-human mammals, which are mostly swine, is possibly an effect of most of those host being in conditioned farms. From this, one might wonder if these geographic clusters have less to do with isolation of a strain within a population, and more to do with geographic characteristics, such as heat and temperature. 
</p>
</div>

<div class="jumbotron" align="center" id="mid">
<p>
The fifth graphic compares the quantity of infections by Strain Subtype, where the first two strains on the bar graph are those that were predicted and had vaccines produced for them. By clicking on the bars you can sort the infections shown on the map and on the line graph. By doing this, another pattern arises. Most strains that cluster towards the northern half of the country, have outbreaks during colder months, particularly December and January. In contrast, strains that cluster towards the southern half of the country, tend to have outbreaks during warmer months, particularly June and August. Once again, the pattern is less marked in non-human mammals, however, the explanation that conditioning in farms shelters livestock from seasonal effects, agrees with the emmerging theory of this analysis : That outbreaks of influenza are more related to the individual characteristics of the strains, namely their ability to grow in different environments. 
</p>

<button onclick="clear()">Clear filter</button> 
<div class="jumbotron" align="center" id="bar">

</div>

</div>

<div class="jumbotron" align="center">
<p>
Further proof on this theory comes from the following two graphics. The first, displays two proportions over time. In black is the proportion of the population that has been infected with influenza. While the pink line shows the percentage of infected people with severe symptoms. Following the pink line shows a stronger connection between percentage of symptomatic patients, and time of the year, than with percentage of the population infected.

The final graphic, depicts two ratios. First it shows the proportion that each age cohort represents of the population in black. Then in pink, it shows what percentage of the people with influenza belong to each age cohort. Anywhere in this graphic where the pink line is over the black line shows a high risk age group. Meaning in these regions youth and elderly, the ratio of people who have influenza is greater than the ratio for that entire group of people. This makes sense, because these groups are generally inmunocompromised, and therefore the most vulnerable. It could be interesting to see if these same groups would fare better in zones where a strain is not at its most active at that time of the year.
</p>

<div class="jumbotron" align="center" id="lines">

</div>

</div>

<div class="jumbotron" align="center" id="conclusion">
<h1>Conclusion</h1>
<p>
These visualizations show the need to further explore the characteristics of strains as they adapt to their environments. Some interesting work that could derive from this would be to map different strain's genomes to the different qualities of the areas where they cluster, such as temperature and humidity. 
</p>
</div>

	<script>
d3.csv('avianDataEx.csv', function(error,avianData){	
d3.csv('humanDataEx.csv', function (error,humanData){
d3.csv('mammalData.csv', function (error,mammalData){
d3.json('us.json', function(error, us) {
//*************************************DATASETS/DATA TRANSFORMATION****************************************************
var dates = []
avianData.forEach(function(d) {
        d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = new Date(d.CollectionDate[2],d.CollectionDate[0]-1,d.CollectionDate[1]);
		d.StoredDate = d.CollectionDate;
		dates.push(d.CollectionDate)
		d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+14);
		d.CollectionDate = d.CollectionDate.getTime()/86400000;
		d.EndDate = d.EndDate.getTime()/86400000;
		
		d.Subtype = d.Subtype.toUpperCase();
    })
	
mammalData.forEach(function(d) {
        d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = new Date(d.CollectionDate[2],d.CollectionDate[0]-1,d.CollectionDate[1]);
		d.StoredDate = d.CollectionDate;
		dates.push(d.CollectionDate)
		d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+14);
		d.CollectionDate = d.CollectionDate.getTime()/86400000;
		d.EndDate = d.EndDate.getTime()/86400000;
		
		d.Subtype = d.Subtype.toUpperCase();
    })
humanData.forEach(function(d) {
		d.Age = d.Age.split(",");
		d.Age = d.Age[0];
		
		d.CollectionDate = d.CollectionDate.split(",");
		d.CollectionDate = d.CollectionDate[0];
		d.CollectionDate = d.CollectionDate.split("/");
		d.CollectionDate = new Date(d.CollectionDate[2],d.CollectionDate[0]-1,d.CollectionDate[1])
		dates.push(d.CollectionDate)
		d.StoredDate = d.CollectionDate;		
		
		if ((d.Age >= 65) || (d.Age <= 10)){
    			d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+14);
  		 } else {d.EndDate = new Date (d.CollectionDate.getFullYear(),d.CollectionDate.getMonth(),d.CollectionDate.getDate()+7);}
		
		d.EndDate = d.EndDate.getTime()/86400000;
		d.CollectionDate = d.CollectionDate.getTime()/86400000;
		 if (d.Temperature == "-N/A-") {
			d.Temperature = "0"
			}
		d.Temperature = +d.Temperature;
		
		if (d.isVaccinated == "1" || d.isVaccinated == "Yes" || d.isVaccinated == "Y") {
			d.isVaccinated = "Y"
			}else {d.isVaccinated = "N"}
		
		if (d.Fever == "1" || d.Fever == "Yes" || d.Fever == "Y") {
			d.Fever = "Y"
			}else {d.Fever = "N"}
			
		d.Symptoms = d.Symptoms.split(",")
	        if (d.Temperature > 99) {
    			var i = 0
      			var counter = 1
      			var k = d.Symptoms.length
      			for(i;i<k;i++){
      				var currentSymptom = d.Symptoms[i]
        			if(currentSymptom.includes("cough")){
        			  var currentArray = currentSymptom.split('(');
					  currentArray = currentArray[1]
				  if ((currentArray.includes("Y") || currentArray.includes("M")) || currentArray.includes("4")) {
          				counter = counter +1 
         			   }
       				 } 
        			if(currentSymptom.includes("myalgia")){
        			  var currentArray = currentSymptom.split('(');
					  currentArray = currentArray[1]
				  if ((currentArray.includes("Y") || currentArray.includes("M")) || currentArray.includes("4")) {
          				counter = counter +1 
         			   }
       				 } 
				 if (counter == 3) { d.Symptoms = 1; i = k; }
			} 
			if (counter<3) {
				d.Symptoms = 0; 
			}
    		}
		d.State = d.State.trim();
		d.Subtype = d.Subtype.split(",");
		d.Subtype = d.Subtype[0];
		if (d.Subtype == "-N/A-" || d.Subtype == "unknown"){
			d.Subtype = "-N/A-"
			}
			
		d.Subtype = d.Subtype.toUpperCase();
})
//More datasets 
var ageCohorts = [
	{Index: '0',  Age: 'Under 5' , Percent: 0.0654304581399327}, 
	{Index: '1',  Age: '5 to 9' , Percent: 0.065907533860457 } ,
	{Index: '2',  Age: '10 to 14' , Percent: 0.0669716366880742 }, 
	{Index: '3',  Age: '15 to 19' , Percent: 0.0713867579844992 } ,
	{Index: '4',  Age: '20 to 24' , Percent: 0.0699151772033059 } ,
	{Index: '5',  Age: '25 to 29' , Percent: 0.0683470573751255 } ,
	{Index: '6',  Age: '30 to 34' , Percent: 0.0646555060497749 } ,
	{Index: '7',  Age: '35 to 39' , Percent: 0.065360108945121 } ,
	{Index: '8',  Age: '40 to 44' , Percent: 0.067664019163898 } ,
	{Index: '9',  Age: '45 to 49' , Percent: 0.0735511552558858 } ,
	{Index: '10',  Age: '50 to 54' , Percent: 0.0722216915082996 } ,
	{Index: '11',  Age: '55 to 59' , Percent: 0.0636925965874202 } ,
	{Index: '12',  Age: '60 to 64' , Percent: 0.0544717961235767 } ,
	{Index: '13',  Age: '65 to 69' , Percent: 0.0402767375378231 } ,
	{Index: '14',  Age: '70 to 74' , Percent: 0.0300511743751905 } ,
	{Index: '15',  Age: '75 to 79' , Percent: 0.0237017028566742 } ,
	{Index: '16',  Age: '80 to 84' , Percent: 0.0186021376606907 } ,
	{Index: '17',  Age: '85 to 89' , Percent: 0.0117263524631083 } ,
	{Index: '18',  Age: '90 to 94' , Percent: 0.00469113176301191} ,
	{Index: '19',  Age: '95 to 99' , Percent: 0.00120242709386135} ,
	{Index: '20',  Age: '100+' , Percent: 0.000172841364269368 }  ];
	
	
var predictedStrains = ["H1N1" ,"H3N2"];
 
	
var stateData = [
	 {Index: 0, State: 'Alabama', Population: 4858979 , Latitude: 32.806671 , Longitude: -86.79113 } , 
	 {Index: 1, State: 'Alaska', Population: 738432 , Latitude: 61.370716 , Longitude: -152.404419 } , 
	 {Index: 2, State: 'Arizona', Population: 6828065 , Latitude: 33.729759 , Longitude: -111.431221 } , 
	 {Index: 3, State: 'Arkansas', Population: 2978204 , Latitude: 34.969704 , Longitude: -92.373123 } , 
	 {Index: 4, State: 'California', Population: 39144818 , Latitude: 36.116203 , Longitude: -119.681564 } , 
	 {Index: 5, State: 'Colorado', Population: 5456574 , Latitude: 39.059811 , Longitude: -105.311104 } , 
	 {Index: 6, State: 'Connecticut', Population: 3590886 , Latitude: 41.597782 , Longitude: -72.755371 } , 
	 {Index: 7, State: 'Delaware', Population: 672228 , Latitude: 39.318523 , Longitude: -75.507141 } , 
	 {Index: 8, State: 'DistrictofColumbia', Population: 945934 , Latitude: 38.897438 , Longitude: -77.026817 } , 
	 {Index: 9, State: 'Florida', Population: 20271272 , Latitude: 27.766279 , Longitude: -81.686783 } , 
	 {Index: 10, State: 'Georgia', Population: 10214860 , Latitude: 33.040619 , Longitude: -83.643074 } , 
	 {Index: 11, State: 'Hawaii', Population: 1431603 , Latitude: 21.094318 , Longitude: -157.498337 } , 
	 {Index: 12, State: 'Idaho', Population: 1654930 , Latitude: 44.240459 , Longitude: -114.478828 } , 
	 {Index: 13, State: 'Illinois', Population: 12859995 , Latitude: 40.349457 , Longitude: -88.986137 } , 
	 {Index: 14, State: 'Indiana', Population: 6619680 , Latitude: 39.849426 , Longitude: -86.258278 } , 
	 {Index: 15, State: 'Iowa', Population: 3123899 , Latitude: 42.011539 , Longitude: -93.210526 } , 
	 {Index: 16, State: 'Kansas', Population: 2911641 , Latitude: 38.5266 , Longitude: -96.726486 } , 
	 {Index: 17, State: 'Kentucky', Population: 4425092 , Latitude: 37.66814 , Longitude: -84.670067 } , 
	 {Index: 18, State: 'Louisiana', Population: 4670724 , Latitude: 31.169546 , Longitude: -91.867805 } , 
	 {Index: 19, State: 'Maine', Population: 1329328 , Latitude: 44.693947 , Longitude: -69.381927 } , 
	 {Index: 20, State: 'Maryland', Population: 6006401 , Latitude: 39.063946 , Longitude: -76.802101 } , 
	 {Index: 21, State: 'Massachusetts', Population: 6794422 , Latitude: 42.230171 , Longitude: -71.530106 } , 
	 {Index: 22, State: 'Michigan', Population: 9922576 , Latitude: 43.326618 , Longitude: -84.536095 } , 
	 {Index: 23, State: 'Minnesota', Population: 5489594 , Latitude: 45.694454 , Longitude: -93.900192 } , 
	 {Index: 24, State: 'Mississippi', Population: 2992333 , Latitude: 32.741646 , Longitude: -89.678696 } , 
	 {Index: 25, State: 'Missouri', Population: 6083672 , Latitude: 38.456085 , Longitude: -92.288368 } , 
	 {Index: 26, State: 'Montana', Population: 1032949 , Latitude: 46.921925 , Longitude: -110.454353 } , 
	 {Index: 27, State: 'Nebraska', Population: 1896190 , Latitude: 41.12537 , Longitude: -98.268082 } , 
	 {Index: 28, State: 'Nevada', Population: 2890845 , Latitude: 38.313515 , Longitude: -117.055374 } , 
	 {Index: 29, State: 'NewHampshire', Population: 1330608 , Latitude: 43.452492 , Longitude: -71.563896 } , 
	 {Index: 30, State: 'NewMexico', Population: 8958013 , Latitude: 40.298904 , Longitude: -74.521011 } , 
	 {Index: 31, State: 'NewJersey', Population: 2085109 , Latitude: 34.840515 , Longitude: -106.248482 } , 
	 {Index: 32, State: 'NewYork', Population: 19795791 , Latitude: 42.165726 , Longitude: -74.948051 } , 
	 {Index: 33, State: 'NorthDakota', Population: 10042802 , Latitude: 35.630066 , Longitude: -79.806419 } , 
	 {Index: 34, State: 'NorthCarolina', Population: 756927 , Latitude: 47.528912 , Longitude: -99.784012 } , 
	 {Index: 35, State: 'Ohio', Population: 11613423 , Latitude: 40.388783 , Longitude: -82.764915 } , 
	 {Index: 36, State: 'Oklahoma', Population: 3911338 , Latitude: 35.565342 , Longitude: -96.928917 } , 
	 {Index: 37, State: 'Oregon', Population: 4028977 , Latitude: 44.572021 , Longitude: -122.070938 } , 
	 {Index: 38, State: 'Pennsylvania', Population: 12802503 , Latitude: 40.590752 , Longitude: -77.209755 } , 
	 {Index: 39, State: 'RhodeIsland', Population: 1056298 , Latitude: 41.680893 , Longitude: -71.51178 } , 
	 {Index: 40, State: 'SouthCarolina', Population: 4896146 , Latitude: 33.856892 , Longitude: -80.945007 } , 
	 {Index: 41, State: 'SouthDakota', Population: 858469 , Latitude: 44.299782 , Longitude: -99.438828 } , 
	 {Index: 42, State: 'Tennessee', Population: 6600299 , Latitude: 35.747845 , Longitude: -86.692345 } , 
	 {Index: 43, State: 'Texas', Population: 27469114 , Latitude: 31.054487 , Longitude: -97.563461 } , 
	 {Index: 44, State: 'Utah', Population: 2995919 , Latitude: 40.150032 , Longitude: -111.862434 } , 
	 {Index: 45, State: 'Vermont', Population: 626042 , Latitude: 44.045876 , Longitude: -72.710686 } , 
	 {Index: 46, State: 'Virginia', Population: 8382993 , Latitude: 37.769337 , Longitude: -78.169968 } , 
	 {Index: 47, State: 'Washington', Population: 7170351 , Latitude: 47.400902 , Longitude: -121.490494 } , 
	 {Index: 48, State: 'WestVirginia', Population: 1844128 , Latitude: 38.491226 , Longitude: -80.954453 } , 
	 {Index: 49, State: 'Wisconsin', Population: 5771337 , Latitude: 44.268543 , Longitude: -89.616508 } , 
	 {Index: 50, State: 'Wyoming', Population: 586107 , Latitude: 42.755966 , Longitude: -107.30249 } 
];
//States with their unique state json ids
var stateNames = [
	 {Index: 1, State: 'Alabama', Abbrv: 'AL' } , 
	 {Index: 2, State: 'Alaska', Abbrv: 'AK' } , 
	 {Index: 4, State: 'Arizona', Abbrv: 'AZ' } , 
	 {Index: 5, State: 'Arkansas', Abbrv: 'AR' } , 
	 {Index: 6, State: 'California', Abbrv: 'CA' } , 
	 {Index: 8, State: 'Colorado', Abbrv: 'CO' } , 
	 {Index: 9, State: 'Connecticut', Abbrv: 'CT' } , 
	 {Index: 10, State: 'Delaware', Abbrv: 'DE' } , 
	 {Index: 11, State: 'DistrictofColumbia', Abbrv: 'DC' } , 
	 {Index: 12, State: 'Florida', Abbrv: 'FL' } , 
	 {Index: 13, State: 'Georgia', Abbrv: 'GA' } , 
	 {Index: 15, State: 'Hawaii', Abbrv: 'HI' } , 
	 {Index: 16, State: 'Idaho', Abbrv: 'ID' } , 
	 {Index: 17, State: 'Illinois', Abbrv: 'IL' } , 
	 {Index: 18, State: 'Indiana', Abbrv: 'IN' } , 
	 {Index: 19, State: 'Iowa', Abbrv: 'IA' } , 
	 {Index: 20, State: 'Kansas', Abbrv: 'KS' } , 
	 {Index: 21, State: 'Kentucky', Abbrv: 'KY' } , 
	 {Index: 22, State: 'Louisiana', Abbrv: 'LA' } , 
	 {Index: 23, State: 'Maine', Abbrv: 'ME' } , 
	 {Index: 24, State: 'Maryland', Abbrv: 'MD' } , 
	 {Index: 25, State: 'Massachusetts', Abbrv: 'MA' } , 
	 {Index: 26, State: 'Michigan', Abbrv: 'MI' } , 
	 {Index: 27, State: 'Minnesota', Abbrv: 'MN' } , 
	 {Index: 28, State: 'Mississippi', Abbrv: 'MS' } , 
	 {Index: 29, State: 'Missouri', Abbrv: 'MO' } , 
	 {Index: 30, State: 'Montana', Abbrv: 'MT' } , 
	 {Index: 31, State: 'Nebraska', Abbrv: 'NE' } , 
	 {Index: 32, State: 'Nevada', Abbrv: 'NV' } , 
	 {Index: 33, State: 'NewHampshire', Abbrv: 'NH' } , 
	 {Index: 34, State: 'NewJersey', Abbrv: 'NJ' } , 
	 {Index: 35, State: 'NewMexico', Abbrv: 'NM' } , 
	 {Index: 36, State: 'NewYork', Abbrv: 'NY' } , 
	 {Index: 37, State: 'NorthCarolina', Abbrv: 'NC' } , 
	 {Index: 38, State: 'NorthDakota', Abbrv: 'ND' } , 
	 {Index: 39, State: 'Ohio', Abbrv: 'OH' } , 
	 {Index: 40, State: 'Oklahoma', Abbrv: 'OK' } , 
	 {Index: 41, State: 'Oregon', Abbrv: 'OR' } , 
	 {Index: 42, State: 'Pennsylvania', Abbrv: 'PA' } , 
	 {Index: 44, State: 'RhodeIsland', Abbrv: 'RI' } , 
	 {Index: 45, State: 'SouthCarolina', Abbrv: 'SC' } , 
	 {Index: 46, State: 'SouthDakota', Abbrv: 'SD' } , 
	 {Index: 47, State: 'Tennessee', Abbrv: 'TN' } , 
	 {Index: 48, State: 'Texas', Abbrv: 'TX' } , 
	 {Index: 49, State: 'Utah', Abbrv: 'UT' } , 
	 {Index: 50, State: 'Vermont', Abbrv: 'VT' } , 
	 {Index: 51, State: 'Virginia', Abbrv: 'VA' } , 
	 {Index: 53, State: 'Washington', Abbrv: 'WA' } , 
	 {Index: 54, State: 'WestVirginia', Abbrv: 'WV' } , 
	 {Index: 55, State: 'Wisconsin', Abbrv: 'WI' } , 
	 {Index: 56, State: 'Wyoming', Abbrv: 'WY' } , 
];
//Adding latitude and longitude to main datasets
var addLongLat = function (dataset){
	dataset.forEach(function(d) {
		var swtch = 0 //switch
		var q = 0 //loop index
		while (swtch == 0){
			if ((stateData[q].State).toUpperCase() == (d.State).toUpperCase()) {
					d.Latitude = stateData[q].Latitude
					d.Longitude = stateData[q].Longitude
					swtch = 1
			} else {q = q+1}}
	})
}
var totalPop = 250442956;
var makeShareData = function(d) { //Only strains shared with humans
		var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if (currentStrain.toUpperCase() == "H1N1".toUpperCase() 
				|| currentStrain.toUpperCase() == "H3".toUpperCase() 
				|| currentStrain.toUpperCase() == "H3N2".toUpperCase() 
				||currentStrain.toUpperCase() == "HXNX".toUpperCase() 
				) {
            	newDataset.push(d[i]);
				}
			}
				
		return newDataset;
	}
var makeExclude = function(d) { //Only strains shared with humans
		var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if (currentStrain.toUpperCase() !== "H1N1".toUpperCase() 
				&& currentStrain.toUpperCase() !== "H3".toUpperCase() 
				&& currentStrain.toUpperCase() !== "H3N2".toUpperCase() 
				&& currentStrain.toUpperCase() !== "HXNX".toUpperCase()
				&& currentStrain.toUpperCase() !== "-N/A-".toUpperCase()
				) {
            	newDataset.push(d[i]);
				}
			}
				
		return newDataset;
	}
addLongLat(humanData)
addLongLat(avianData)
addLongLat(mammalData)
var sharedHuman = makeShareData(humanData)
var sharedAvian = makeShareData(avianData)
var sharedMammal = makeShareData(mammalData)
var excludeHuman = makeExclude(humanData)
var excludeAvian = makeExclude(avianData)
var excludeMammal = makeExclude(mammalData)
//sort by date
humanData.sort(function(a, b) {
    return a.CollectionDate - b.CollectionDate;
	});
	
avianData.sort(function(a, b) {
    return a.CollectionDate - b.CollectionDate;
	});
	
mammalData.sort(function(a, b) {
    return a.CollectionDate - b.CollectionDate;
	});

var monthScale = d3.scaleOrdinal()
    .range(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"])
    .domain([0,1,2,3,4,5,6,7,8,9,10,11]);
	
//*************************************FILTERS****************************************************
 
// Strain filter 
var filterStrain = function(d,Strain) { // change to map graphic 
        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentStrain = d[i].Subtype;
            if (currentStrain.toUpperCase() == Strain.toUpperCase()) {
            	newDataset.push(d[i]);
				}
			}
		return newDataset;
	}  
 
// Date filter 
var filterDate = function(d,Month,Year) { // change to map graphic 
        var i = 0; 
        var k = d.length;
		
        var newDataset = []; //Our filtered dataset
		
        for(i; i<k; i++) {
            var currentMonth = d[i].StoredDate.getMonth();
            var currentYear = d[i].StoredDate.getFullYear();
            if (currentMonth == Month && currentYear == Year) {
            	newDataset.push(d[i]);
				}
			}
		return newDataset;
	}   

var clear = function(){
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',1)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',1)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',1)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',1)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',1)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',1)

				var fh = humanData
				var fa = avianData
				var fm = mammalData
								
				dispatch.call('graph',this,fh,fa,fm,5)
			}

//*************************************STATS****************************************************
	
//Stats//Graph 1: The Map....
var graph1Stats = function (d,start,end) {
var data = []
	for (j=0; j < stateData.length;j++){
		var searchingState = stateData[j].State;
       
			var count = 0;
			var i = 0;
			
			for(i;i<d.length;i++){
				if(d[i].State == searchingState && ((d[i].CollectionDate >= start) || (d[i].EndDate <= end))){
						count = count+1;
					}
				}
		data.push({ Index: j,
					State: searchingState, 
					Count: count,
					Population: stateData[j].Population,
					Latitude: stateData[j].Latitude, 
					Longitude: stateData[j].Longitude})
	}
	
	return data
}
		
 //Stats//Graph 2: Quantity of Infections
 
 var makeRange = function (d) {
	var minCollectionDateH = 100000000000000;
	var maxEndDateH = 0;
	
	var minStored = 0
	var maxStored = 0
	
	//Find earliest and latest date in dataset
    for(i=0;i<d.length;i++){
    var currentCollectionDate = d[i].CollectionDate;
	var currentEndDate = d[i].EndDate;
		
    if(currentCollectionDate < minCollectionDateH){
      	minCollectionDateH = currentCollectionDate;
		minStored = d[i].StoredDate
      }
    if(currentEndDate > maxEndDateH){
      	maxEndDateH = currentEndDate;
		maxStored = d[i].StoredDate
      } 
    }
	
	return [minCollectionDateH,maxEndDateH,minStored,maxStored];
	
	}
	
	var humanRange = makeRange(humanData)
	var avianRange = makeRange(avianData)
	var mammalRange = makeRange(mammalData)
	
	//Choose the stricter values
	var minCollectionDate = Math.max(humanRange[0],avianRange[0],mammalRange[0])
	var maxEndDate = Math.min(humanRange[1],avianRange[1],mammalRange[1]);
	var minStored = Math.max(humanRange[2],avianRange[2],mammalRange[2])
	var maxStored = Math.min(humanRange[3],avianRange[3],mammalRange[3]);
	
var graph2Stats = function(d) {
	var minStoredLocal = minStored;	
    var twoData = [];//both
	
	//Find count of contagious at date
    for(currentDate = minCollectionDate; currentDate < maxEndDate; currentDate++){
		
		var count = 0;
		
      for(i=0;i<d.length;i++){
      	if((d[i].CollectionDate <= currentDate) && (d[i].EndDate >= currentDate)){
			minStoredLocal = d[i].StoredDate
        	count = count+1; 
        }
      }
      twoData.push({Date: currentDate, Value: count, StoredDate: minStoredLocal});
    }

	return twoData;
}
//Stats//Graph 3: Percent Infected compared to Symptomatic Infection
var graph3Stats = function(d,Population) {
    var threeData = [];
	var count = 0;
	var symptomCounter = 0;
    for(currentDate = minCollectionDate; currentDate < maxEndDate; currentDate++){
		var i = 0;
      for(i;i<d.length;i++){
      	if((d[i].CollectionDate <= currentDate) && (d[i].EndDate >= currentDate)){
        	count = count+1; 		
          if(d[i].Symptoms == 1){
          	symptomCounter = symptomCounter + 1;
          }
        }
      }
	  var sympPercent = function() {if (count==0){return 0} else {return (symptomCounter/count)*100}}
	  var sCounter = sympPercent()
	  var countV = (count/Population)*100000
      threeData.push({Date: currentDate, Value: countV, SymptomCount: sCounter});
    }
	return threeData;
}
//Stats//Graph 4: Percent of Infected over Age
var graph4Stats = function(d) {
  var i =0;
  var k = 21
  var fourData = [];
  for(i;i<k;i++){ 
  		var minAge = i * 5;
      var maxAge = (i*5)+4;
      var counter = 0; 
      var g = 0 ;
      var h= d.length;
      for(g;g<h;g++){
      		var currentAge = d[g].Age;
          if((currentAge>= minAge) && (currentAge <= maxAge)) {
          	counter = counter + 1;
          }
      }
      popPercent = 100*(counter/h);
      fourData.push({Index: i, PopulationPercent: popPercent});
  }
  return fourData;
}
//Stats//Graph 5: Infections by Strain
var graph5Stats = function (d) {
	strainsVisited = [];
	strainData = [];
	
	for (i=0;i<d.length;i++){
		if (strainsVisited.includes(d[i].Subtype)) {
			var b = 0 //switch
			var t = 0 //loop index
			while (b == 0){
				if (strainData[t].Strain == d[i].Subtype) {
						strainData[t] = {Strain: d[i].Subtype, Count:(strainData[t].Count + 1)}
						b = 1
				} else {t = t+1}}
		}else {
			strainData.push({Strain: d[i].Subtype,Count:1})
			strainsVisited.push(d[i].Subtype);
			}
	}
	var sorterC = 4	
	var sorter = function (s) {
		if  (s.toUpperCase() == "H1N1".toUpperCase()){return 1}else if
			(s.toUpperCase() == "H3".toUpperCase()){return 2}else if
			(s.toUpperCase() == "H3N2".toUpperCase()){return 0}else if
			(s.toUpperCase() == "HXNX".toUpperCase()){return 3}else
			{sorterC = sorterC + 1
			return sorterC}
			}
		
	strainData.sort(function(a, b) {
    return b.Count - a.Count;
	});
	var tb = 0
	var i = 0
	while (i<strainData.length){
		if (sorterC < 18) {
		strainData[i] = {Index: sorter(strainData[i].Strain) , Strain: strainData[i].Strain, Count: strainData[i].Count}
		i = i+1}else {
		strainData.splice(i,strainData.length-i)
		i = strainData.length}
		}
	strainData.sort(function(a, b) {
    return a.Index - b.Index;
	});
	
	return strainData;
}
//*************************************GRAPHS****************************************************

//svg containers 	

var border= 4;
var bordercolor = "black";
			
	var SVG1G = d3.select("#map")
		.append('svg')
		.attr('width', 1000)
		.attr('height', 600)

		
	var SVG1 = SVG1G.append("g")
	.attr('transform','scale(0.85)');
		
	var SVG2G = d3.select("#map")
		.append('svg')
		.attr('width', 1070)
		.attr('height', 270)
		
	var SVG2 = SVG2G.append("g")
	.attr('transform','scale(0.75)');
		
	var SVG5G = d3.select("#bar")
		.append('svg')
		.attr('width', 920)
		.attr('height', 270)
		
	var SVG5 = SVG5G.append("g")
	//.attr('transform','scale(0.5)');
	
	var SVG3G =d3.select("#lines")
		.append('svg')
		.attr('width', 560)
		.attr('height', 370)
		
	var SVG3 = SVG3G.append("g")
	//.attr('transform','scale(0.5)');
	
	var SVG4G = d3.select("#lines")
		.append('svg')
		.attr('width', 560)
		.attr('height', 370)
		
	var SVG4 = SVG4G.append("g")
	//.attr('transform','scale(0.5)');

//Graph//Graph 1: The Map...	

var graph1a = SVG1.append("g");
var graph1b = SVG1.append("g");
var graph1c = SVG1.append("g");

var dataset1H = graph1Stats(humanData,minCollectionDate,maxEndDate)
var dataset1A = graph1Stats(avianData,minCollectionDate,maxEndDate)
var dataset1M = graph1Stats(mammalData,minCollectionDate,maxEndDate)

				
dataset1H.forEach(function(d){
	d.Count = (d.Count/d.Population)*100000;
	})
var projection = d3.geoAlbersUsa()
var path = d3.geoPath()
    .projection(projection);
var countScaleH = d3.scaleLinear()
		.domain([0,7])
		.range([0,60]);
var countScaleA = d3.scaleLinear()
		.domain([0,700])
		.range([0,60]);
var countScaleM = d3.scaleLinear()
		.domain([0,900])
		.range([0,60]);		
		
		var mouseEvent1 = SVG1.append("g")
		
			mouseEvent1.append('text')
				.attr("y", 60)
				.attr("x", 60)
				.style("text-anchor", "middle")
				.style('fill', 'black')
				.text();
		
	graph1a.append("path")
		.attr("class", "states")
		.datum(topojson.feature(us, us.objects.states))
		.attr("d", path);
		
	graph1a.selectAll('mapCases')
		.data(dataset1H)
        .enter()
		.append('circle')
		.style('opacity', 0.5)
		.attr('r',function(d) { return countScaleH(d.Count);})		
        .attr('fill', 'black')
		.attr("transform", function(d) {
				var latlong = projection([d.Longitude,d.Latitude]);
				return "translate(" + [latlong[0]+5,latlong[1]+5] + ")";})
		.on('click',function(d) {console.log(d.Count)})
		.on('mouseover', function(d) {
		mouseEvent1.selectAll('text')
					.attr("y", 50)
					.attr("x", 700)
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(d.State + ", Count: " + Math.round((d.Count/100000)*d.Population));
		})
		.on('mouseout', function(d) {
		mouseEvent1.selectAll('text')
					.text("");
		})
	graph1b.selectAll('mapCases')
		.data(dataset1A)
        .enter()
		.append('circle')
		.style('opacity', 0.5)
		.attr('r',function(d) { return countScaleA(d.Count);})		
        .attr('fill', 'red')
		.attr("transform", function(d) {
				var latlong = projection([d.Longitude,d.Latitude]);
				return "translate(" + [latlong[0]+10,latlong[1]+10] + ")";})
		.on('click',function(d) {console.log(d.Count)})
		.on('mouseover', function(d) {
		mouseEvent1.selectAll('text')
					.attr("y", 50)
					.attr("x", 700)
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(d.State + ", Count: " + d.Count);
		})
		.on('mouseout', function(d) {
		mouseEvent1.selectAll('text')
					.text("");
		})
	
	graph1c.selectAll('mapCases')
		.data(dataset1M)
        .enter()
		.append('circle')
		.style('opacity', 0.5)
		.attr('r',function(d) { return countScaleM(d.Count);})		
        .attr('fill', 'blue')
		.attr("transform", function(d) {
				var latlong = projection([d.Longitude,d.Latitude]);
				return "translate(" + [latlong[0]+15,latlong[1]+15] + ")";})
		.on('click',function(d) {console.log(d.Count)})
		.on('mouseover', function(d) {
		mouseEvent1.selectAll('text')
					.attr("y", 50)
					.attr("x", 700)
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(d.State + ", Count: " + d.Count);
		})
		.on('mouseout', function(d) {
		mouseEvent1.selectAll('text')
					.text("");
		})
		// legend
		SVG1.append('text')
			.attr("y", 400)
			.attr("x", 750)
			.style("text-anchor", "left")
			.text("Human Infections");
		SVG1.append('text')
			.attr("y", 420)
			.attr("x", 750)
			.style("text-anchor", "left")
			.style('fill','red')
			.text("Avian Infections");
		SVG1.append('text')
			.attr("y", 440)
			.attr("x", 750)
			.style("text-anchor", "left")
			.style('fill', 'blue')
			.text("Non-human Mammalian Infections");
		
//Graph//Graph 2: Quantity of Infections
var graph2a = SVG2.append("g");
var graph2b = SVG2.append("g");
var graph2c = SVG2.append("g");
var dataset2H = graph2Stats(humanData,avianData,mammalData)
var dataset2A = graph2Stats(avianData,humanData,mammalData)
var dataset2M = graph2Stats(mammalData,humanData,avianData)

//Scales for line graph
	//For line chart
	var xScale2 = d3.scaleLinear()
		.domain([minCollectionDate,maxEndDate])
		.range([0,1000]);
	var yScale2 = d3.scaleLinear()
		.domain([0,280])
		.range([200,0]);
		
		//Min Date: Mar 13 2012
		//Max Date:Mar 2 2014
		
	var xMonths = d3.scaleBand()
    .domain(["Apr2012","May2012","Jun2012","Jul2012","Aug2012","Sep2012","Oct2012","Nov2012","Dec2012",//2012
			"Jan2013","Feb2013","Mar2013","Apr2013","May2013","Jun2013","Jul2013","Aug2013","Sep2013","Oct2013","Nov2013","Dec2013", //2013
			"Jan2014","Feb2014","Mar2014"//2014
			])
    .range([0, 1000]);	
		
		console.log

	var line2 = d3.line()
		
		.x(function(d) { 
			return xScale2(d.Date); 
			})
		.y(function(d) { 
			return yScale2(d.Value); 
			})
		
	
		graph2a.append('path')
		.datum(dataset2H)
		.attr('d', line2)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		graph2b.append('path')
		.datum(dataset2A)
		.attr('d', line2)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke-width',1)
		.attr('stroke','red')
		.attr('stroke-width',2)
		
		graph2c.append('path')
		.datum(dataset2M)
		.attr('d', line2)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','blue')
		.attr('stroke-width',2);
		
		var g2ax = SVG2.append('g').attr('transform', 'translate(50, 210)').call(d3.axisBottom(xMonths));
		SVG2.append('text')
			.attr("x", 550)
			.attr("y", 250)
			.style("text-anchor", "middle")
			.text("Date");
			
		g2ax.selectAll("text")
			.attr("transform", "rotate(-10)")
			.style("text-anchor", "middle")
					
		SVG2.append('g').attr('transform', 'translate(50,10)').call(d3.axisLeft(yScale2));
		SVG2.append('text')
			.attr("y", 20)
			.attr("x", -115)
			.attr("transform", "rotate(-90)")
			.style("text-anchor", "middle")
			.text("Quantity of Contagious Infections");
		// legend
		SVG2.append('text')
			.attr("y", 20)
			.attr("x", 60)
			.style("text-anchor", "left")
			.text("Human Infections");
		SVG2.append('text')
			.attr("y", 40)
			.attr("x", 60)
			.style("text-anchor", "left")
			.style('fill','red')
			.text("Avian Infections");
		SVG2.append('text')
			.attr("y", 60)
			.attr("x", 60)
			.style("text-anchor", "left")
			.style('fill', 'blue')
			.text("Non-human Mammalian Infections");
		var mouseEvent2 = SVG2.append("g")
		
			mouseEvent2.append('text')
				.attr("y", 60)
				.attr("x", 60)
				.style("text-anchor", "middle")
				.style('fill', 'black')
				.text();
	graph2a.selectAll('circle')
		.data(dataset2H)
        .enter()
		.append('circle')
        .attr('transform','translate(50,10)')
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale2(d.Date);
                    })
		.attr('r',10)		
        .attr('fill', 'black')
		.style('opacity',0)
		.on('mouseover', function(d){
				mouseEvent2.selectAll('text')
					.attr("y", yScale2(d.Value)+5)
					.attr("x", xScale2(d.Date))
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(monthScale(d.StoredDate.getMonth())+ d.StoredDate.getFullYear());
				
				graph2a.selectAll('path')
					.transition()
					.attr('stroke-width',3)
				graph2b.selectAll('path')
					.transition()
					.style('opacity',0.3)
				graph2c.selectAll('path')
					.transition()
					.style('opacity',0.3)
					
		})
		.on('mouseout',  function(d){
				mouseEvent2.selectAll('text')
					.text("");
				
				graph2a.selectAll('path')
					.transition()
					.attr('stroke-width',2)
				graph2b.selectAll('path')
					.transition()
					.style('opacity',1)
				graph2c.selectAll('path')
					.transition()
					.style('opacity',1)		
		})
			
	graph2b.selectAll('circle')
		.data(dataset2A)
        .enter()
		.append('circle')
        .attr('transform','translate(50,10)')
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale2(d.Date);
                    })
		.attr('r',10)		
        .attr('fill', 'red')
		.style('opacity',0)
		.on('mouseover', function(d){
				mouseEvent2.selectAll('text')
					.attr("y", yScale2(d.Value)+5)
					.attr("x", xScale2(d.Date))
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(monthScale(d.StoredDate.getMonth())+ d.StoredDate.getFullYear());
				
				graph2a.selectAll('path')
					.transition()
					.style('opacity',0.3)
				graph2b.selectAll('path')
					.transition()
					.attr('stroke-width',3)
				graph2c.selectAll('path')
					.transition()
					.style('opacity',0.3)
					
		})
		.on('mouseout',  function(d){
				mouseEvent2.selectAll('text')
					.text("");
				
				graph2a.selectAll('path')
					.transition()
					.style('opacity',1)
				graph2b.selectAll('path')
					.transition()
					.attr('stroke-width',2)
				graph2c.selectAll('path')
					.transition()
					.style('opacity',1)					
		})
	
	graph2c.selectAll('circle')
		.data(dataset2M)
        .enter()
		.append('circle')
        .attr('transform','translate(50,10)')
        .attr('cy',function (d) {
                    return yScale2(d.Value);
                    })
        .attr('cx',function (d) {
                    return xScale2(d.Date);
                    })
		.attr('r',10)		
        .attr('fill', 'blue')
		.style('opacity',0)
		.on('mouseover', function(d){
				mouseEvent2.selectAll('text')
					.attr("y", yScale2(d.Value)+5)
					.attr("x", xScale2(d.Date))
					.style("text-anchor", "middle")
					.style('fill', 'black')
					.text(monthScale(d.StoredDate.getMonth())+ d.StoredDate.getFullYear());
				
				graph2a.selectAll('path')
					.transition()
					.style('opacity',0.3)
				graph2b.selectAll('path')
					.transition()
					.style('opacity',0.3)
				graph2c.selectAll('path')
					.transition()
					.attr('stroke-width',3)
				/*	
				var fh = filterDate(humanData,d.StoredDate.getMonth(),d.StoredDate.getFullYear())
				var fa = filterDate(avianData,d.StoredDate.getMonth(),d.StoredDate.getFullYear())
				var fm = filterDate(mammalData,d.StoredDate.getMonth(),d.StoredDate.getFullYear())
								
				dispatch.call('graph',this,fh,fa,fm,2)
				*/	
		})
		.on('mouseout',  function(d){
				mouseEvent2.selectAll('text')
					.text("");
				
				graph2a.selectAll('path')
					.transition()
					.style('opacity',1)
				graph2b.selectAll('path')
					.transition()
					.style('opacity',1)
				graph2c.selectAll('path')
					.transition()
					.attr('stroke-width',2)
				/*	
				var fh = humanData
				var fa = avianData
				var fm = mammalData
								
				dispatch.call('graph',this,fh,fa,fm,6)
				*/	
		})
/*		
var brush = SVG2.append("g")
    .attr("class", "brush")
    .call(d3.brushX()
        .on("end", brushed));*/
		/*
var brush = d3.brushX()
    .on("brush end", brushed);

SVG2.append("g")
    .attr("class", "brush")	
	.call(brush)
	
function brushed() {
   var extent = brush.extent();
   console.log(extent[0])
   
  var s = d3.event.selection || xMonths.range();
  x.domain(s.map(x2.invert, x2));
  focus.select(".area").attr("d", area);
  focus.select(".axis--x").call(xAxis);
  svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
      .scale(width / (s[1] - s[0]))
      .translate(-s[0], 0));
}
*/

//Graph//Graph 3: Percent Infected compared to Symptomatic Infection
var dataset3 = graph3Stats(humanData,totalPop)
var graph3a = SVG3.append("g");
var graph3b = SVG3.append("g");

//Scales for line graph
	//For line chart
	var xScale3 = d3.scaleLinear()
		.domain([minCollectionDate,maxEndDate])
		.range([0,500]);
	var yScale3 = d3.scaleLinear()
		.domain([0,10])
		.range([300,0]);
		
		var xMonths3 = d3.scaleBand()
    .domain(["Apr2012","Jun2012","Aug2012","Oct2012","Dec2012",//2012
			"Feb2013","Apr2013","Jun2013","Aug2013","Oct2013","Dec2013", //2013
			"Feb2014"//2014
			])
    .range([0, 500]);
		
	var line3a = d3.line()
		
		.x(function(d) { 
			return xScale3(d.Date); 
			})
		.y(function(d) { 
			return yScale3(d.SymptomCount); 
			})
		
		
	var line3b = d3.line()
		
		.x(function(d) { 
			return xScale3(d.Date); 
			})
		.y(function(d) { 
			return yScale3(d.Value); 
			})
			
		graph3a.append('path')
		.datum(dataset3)
		.attr('d', line3a)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','violet')
		.attr('stroke-width',2)
		
		graph3b.append('path')
		.datum(dataset3)
		.attr('d', line3b)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		var axMonth = SVG3.append('g').attr('transform', 'translate(50, 310)').call(d3.axisBottom(xMonths3));
		SVG3.append('g').attr('transform', 'translate(50, 10)').call(d3.axisLeft(yScale3));
		
		axMonth.selectAll("text")
			.style("text-anchor", "middle")
			.attr("transform", "rotate(-10)")
		
		SVG3.append('text')
			.attr("x", 300)
			.attr("y", 350)
			.style("text-anchor", "middle")
			.text("Date");
		
		SVG3.append('text')
			.attr("y", 20)
			.attr("x", -160)
			.attr("transform", "rotate(-90)")
			.style("text-anchor", "middle")
			.text("Percent Infected")	
			
		// Legend thing
		SVG3.append('text')
			.attr("y", 50)
			.attr("x", 400)
			.style("text-anchor", "middle")
			.style("fill", "violet")
			.text("Percent of Infected with Symptoms");
		SVG3.append('text')
			.attr("y", 70)
			.attr("x", 400)
			.style("text-anchor", "middle")
			.text("Percent of Population Infected");
		
//Graph//Graph 4: Percent of Infected over Age
var graph4a = SVG4.append("g");
var graph4b = SVG4.append("g");
var dataset4 = graph4Stats(humanData)

//Scales for line graph
	//For line chart
	var xScale4 = d3.scaleLinear()
		.domain([0,20])
		.range([0,500]);
	var yScale4 = d3.scaleLinear()
		.domain([0,20])
		.range([300,0]);
		
	var xAges = d3.scaleBand()
    .domain(["5-9","15-19","25-29","35-39","45-49",
			"55-59","65-69","75-79","85-89","95-99"
			])
    .range([0, 500]);
		
  var line4a = d3.line()
		.x(function(d) { 
			return xScale4(d.Index); 
			})
		.y(function(d) { 
			return yScale4(d.PopulationPercent); 
			})
		
	var line4b = d3.line()
		.x(function(d) { 
			return xScale4(d.Index); 
			})
		.y(function(d) { 
			return yScale4(d.Percent*100); 
			})
			
		graph4a.append('path')
		.datum(dataset4)
		.attr('d', line4a)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','violet')
		.attr('stroke-width',2)
		
		graph4b.append('path')
		.datum(ageCohorts)
		.attr('d', line4b)
		.attr('transform','translate(50,10)')
		.attr('fill','none')
		.attr('stroke','black')
		.attr('stroke-width',2)
		
		
		graph4a.selectAll('lineChart')
		.data(dataset4)
        .enter()
		.append('circle')
        .attr('transform','translate(50,10)')
        .attr('cy',function (d) {
                    return yScale4(d.PopulationPercent);
                    })
        .attr('cx',function (d) {
                    return xScale4(d.Index);
                    })
		.attr('r',4)		
        .attr('fill', 'violet')
			
	graph4b.selectAll('lineChart')
		.data(ageCohorts)
        .enter()
		.append('circle')
        .attr('transform','translate(50,10)')
        .attr('cy',function (d) {
                    return yScale4(d.Percent*100);
                    })
        .attr('cx',function (d) {
                    return xScale4(d.Index);
                    })
		.attr('r',4)		
        .attr('fill', 'black')
		
		SVG4.append('g').attr('transform', 'translate(50, 310)').call(d3.axisBottom(xAges));
		SVG4.append('g').attr('transform', 'translate(50, 10)').call(d3.axisLeft(yScale4));
		
		SVG4.append('text')
			.attr("x", 300)
			.attr("y", 350)
			.style("text-anchor", "middle")
			.text("Age Group");
		
		SVG4.append('text')
			.attr("y", 20)
			.attr("x", -160)
			.attr("transform", "rotate(-90)")
			.style("text-anchor", "middle")
			.text("Percentage (%)")
			
		// Legend thing
		SVG4.append('text')
			.attr("y", 50)
			.attr("x", 400)
			.style("text-anchor", "middle")
			.style("fill", "violet")
			.text("Percent of Infected in Age Group");
		SVG4.append('text')
			.attr("y", 70)
			.attr("x", 400)
			.style("text-anchor", "middle")
			.text("Percent of Population in Age Group");
		
//Graph//Graph 5: Infections by Strain

var graph5a = SVG5.append("g");
var graph5b = SVG5.append("g");
var graph5c = SVG5.append("g");
var graph5e = SVG5.append("g");
var graph5f = SVG5.append("g");
var graph5d = SVG5.append("g");

var barDatasetHS = graph5Stats(sharedHuman) //human shared
var barDatasetAS = graph5Stats(sharedAvian) // avian shared 
var barDatasetMS = graph5Stats(sharedMammal) //mammal shared
var barDatasetHE = graph5Stats(excludeHuman) //human excluding shared
var barDatasetAE = graph5Stats(excludeAvian) // avian excluding shared
var barDatasetME = graph5Stats(excludeMammal)// mammal excluding shared


	//Scales
	var xScale5 = d3.scaleLinear()
		.domain([0,barDatasetHS.length-1])
		.range([0,250]);
	var xScale5b = d3.scaleLinear()
		.domain([0,barDatasetHE.length-1])
		.range([0,100]);
	var xScale5c = d3.scaleLinear()
		.domain([0,barDatasetAE.length-1])
		.range([0,300]);
	var xScale5d = d3.scaleLinear()
		.domain([0,barDatasetME.length-1])
		.range([0,25]);
	var yScale5 = d3.scaleLinear()
		.domain([0,85])
		.range([200,0]);
		
var strainsS = []
var strainsHE = []
var strainsAE = []
var strainsME = []

var indexS = []
var indexHE = []
var indexAE = []
var indexME = []

barDatasetHS.forEach(function(d){
	strainsS.push(d.Strain)
	indexS.push(xScale5(d.Index)+30)
	})

barDatasetHE.forEach(function(d){
	strainsHE.push(d.Strain)
	indexHE.push(xScale5b(d.Index)+10)
	})
barDatasetAE.forEach(function(d){
	strainsAE.push(d.Strain)
	indexAE.push(xScale5c(d.Index)+10)
	})
barDatasetME.forEach(function(d){
	strainsME.push(d.Strain)
	indexME.push(xScale5d(d.Index)+10)
	})
		
	var xStrainsS = d3.scaleOrdinal()
    .domain(strainsS)
    .range(indexS);	
	var xStrainsHE = d3.scaleOrdinal()
    .domain(strainsHE)
    .range(indexHE);
	var xStrainsAE = d3.scaleOrdinal()
    .domain(strainsAE)
    .range(indexAE);
	var xStrainsME = d3.scaleOrdinal()
    .domain(strainsME)
    .range(indexME);
	
	graph5a.selectAll("bar")
		.data(barDatasetHS)
		.enter()
		.append('rect')
		.attr('transform','translate(50,10)')
		.attr('x', function (d) { 
					return xScale5(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/sharedHuman.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/sharedHuman.length)*100);
					})
		.attr('fill','black')
		.on("click", function(d){
			var fh = filterStrain(sharedHuman,d.Strain)
			var fa = filterStrain(sharedAvian,d.Strain)
			var fm = filterStrain(sharedMammal,d.Strain)
			
			console.log(d.Strain)
			
			dispatch.call('graph',this,fh,fa,fm,5)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
	graph5b.selectAll("bar")
		.data(barDatasetAS)
		.enter()
		.append('rect')
		.attr('transform','translate(50,10)')
		.attr('x', function (d) { 
		
					return xScale5(d.Index)+20;
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/sharedAvian.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/sharedAvian.length)*100);
					})
		.attr('fill','red')
		.on("click", function(d){
			var fh = filterStrain(sharedHuman,d.Strain)
			var fa = filterStrain(sharedAvian,d.Strain)
			var fm = filterStrain(sharedMammal,d.Strain)
			
			dispatch.call('graph',this,fh,fa,fm,5)
			
			console.log(d.Strain)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
		
	graph5c.selectAll("bar")
		.data(barDatasetMS)
		.enter()
		.append('rect')
		.attr('transform','translate(50,10)')
		.attr('x', function (d) { 
					return xScale5(d.Index)+40;
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/sharedMammal.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/sharedMammal.length)*100);
					})
		.attr('fill','blue')
		.on("click", function(d){
			var fh = filterStrain(sharedHuman,d.Strain)
			var fa = filterStrain(sharedAvian,d.Strain)
			var fm = filterStrain(sharedMammal,d.Strain)
			
			dispatch.call('graph',this,fh,fa,fm,5)
			
			console.log(d.Strain)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
		
	graph5d.selectAll("bar")
		.data(barDatasetHE)
		.enter()
		.append('rect')
		.attr('transform','translate(260,10)')
		.attr('x', function (d) { 
					return xScale5b(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/sharedHuman.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/sharedHuman.length)*100);
					})
		.attr('fill','black')
		.on("click", function(d){
			var fh = filterStrain(excludeHuman,d.Strain)
			var fa = filterStrain(excludeAvian,d.Strain)
			var fm = filterStrain(excludeMammal,d.Strain)
			
			dispatch.call('graph',this,fh,fa,fm,5)
			
			console.log(d.Strain)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
	
	graph5e.selectAll("bar")
		.data(barDatasetAE)
		.enter()
		.append('rect')
		.attr('transform','translate(400,10)')
		.attr('x', function (d) { 
					return xScale5c(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/excludeAvian.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/excludeAvian.length)*100);
					})
		.attr('fill','red')
		.on("click", function(d){
			var fh = filterStrain(excludeHuman,d.Strain)
			var fa = filterStrain(excludeAvian,d.Strain)
			var fm = filterStrain(excludeMammal,d.Strain)

			dispatch.call('graph',this,fh,fa,fm,5)
			
			console.log(d.Strain)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
	graph5f.selectAll("bar")
		.data(barDatasetME)
		.enter()
		.append('rect')
		.attr('transform','translate(720,10)')
		.attr('x', function (d) { 
					return xScale5d(d.Index);
					})
		.attr('y', function (d) { 
					return yScale5((d.Count/excludeMammal.length)*100);
					})
		.attr('width', 20)
		.attr('height', function (d) { 
					return 200 - yScale5((d.Count/excludeMammal.length)*100);
					})
		.attr('fill','blue')
		.on("click", function(d){
			var fh = filterStrain(excludeHuman,d.Strain)
			var fa = filterStrain(excludeAvian,d.Strain)
			var fm = filterStrain(excludeMammal,d.Strain)
			
			dispatch.call('graph',this,fh,fa,fm,5)
			
			console.log(d.Strain)
			
			graph5a.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5b.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5c.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5d.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5e.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			graph5f.selectAll('rect')
			.transition()
			.style('opacity',0.5)
			d3.select(this)
			.transition()
			.style('opacity',1)
		})
		.on("mouseover", function(d){
			d3.select(this)
			.transition()
			.style('opacity',0.5)
			})
		.on("mouseout", function(d){
			d3.select(this)
			.transition()
			.style('opacity',1)
			})
	
		var ax1 = SVG5.append('g').attr('transform', 'translate(50, 210)').call(d3.axisBottom(xStrainsS));
		var ax2 = SVG5.append('g').attr('transform', 'translate(260, 210)').call(d3.axisBottom(xStrainsHE));
		var ax3 = SVG5.append('g').attr('transform', 'translate(400, 210)').call(d3.axisBottom(xStrainsAE));
		var ax4 = SVG5.append('g').attr('transform', 'translate(720, 210)').call(d3.axisBottom(xStrainsME));
		var ax5 = SVG5.append('g').attr('transform', 'translate(50, 10)').call(d3.axisLeft(yScale5));
		
	ax1.selectAll("text")
    .attr("transform", "rotate(-30)")
	.style("text-anchor", "middle")
	ax2.selectAll("text")
    .attr("transform", "rotate(-30)")
	.style("text-anchor", "middle")
	ax3.selectAll("text")
    .attr("transform", "rotate(-30)")
	.style("text-anchor", "middle")
	ax4.selectAll("text")
    .attr("transform", "rotate(-30)")
	.style("text-anchor", "middle")
	
	SVG5.append('text')
			.attr("x", 450)
			.attr("y", 250)
			.style("text-anchor", "middle")
			.text("Strains");
		
		SVG5.append('text')
			.attr("y", 20)
			.attr("x", -110)
			.attr("transform", "rotate(-90)")
			.style("text-anchor", "middle")
			.text("Percentage (%)")
			
		// Legend thing
		SVG5.append('text')
			.attr("y", 50)
			.attr("x", 600)
			.style("text-anchor", "left")
			.style("fill", "black")
			.text("Human Strain");
		SVG5.append('text')
			.attr("y", 70)
			.attr("x", 600)
			.style("text-anchor", "left")
			.style("fill", "red")
			.text("Avian Strains");
		SVG5.append('text')
			.attr("y", 90)
			.attr("x", 600)
			.style("fill", "blue")
			.style("text-anchor", "left")
			.text("Non-human Mammalian Strains");


		
		
		
//*************************************DISPATCHES****************************************************
var dispatch = d3.dispatch('graph');
//Dispatch//Graph 1: The Map...	
dispatch.on('graph.one', function(filteredH,filteredA, filteredM,clicked){
	if (clicked == 2 || clicked == 5) {
	var datasetH = graph1Stats(filteredH,0,10000000000000)
	var datasetA = graph1Stats(filteredA,0,10000000000000)
	var datasetM = graph1Stats(filteredM,0,1000000000000)
datasetH.forEach(function(d){
	d.Count = (d.Count/d.Population)*100000;
	})
	
	graph1a.selectAll('circle')
		.data(datasetH)
		.transition()
		.attr('r',function (d) {
                    return countScaleH(d.Count);
                    })
		
	graph1b.selectAll('circle')
		.data(datasetA)
		.transition()
		.attr('r',function (d) {
                    return countScaleA(d.Count);
                    })
					
	graph1c.selectAll('circle')
		.data(datasetM)
		.transition()
		.attr('r',function (d) {
                    return countScaleM(d.Count);
                    })
	}
})
	
//Dispatch//Graph 2: Quantity of Infections
dispatch.on('graph.two', function(filteredH,filteredA,filteredM,clicked){
if (clicked !== 2) {
var datasetH = graph2Stats(filteredH,filteredA,filteredM)
var datasetA = graph2Stats(filteredA,filteredH,filteredM)
var datasetM = graph2Stats(filteredM,filteredH,filteredA)
	graph2a.selectAll('path')
		.datum(datasetH)
		.transition()
		.attr('d', line2)
		
	graph2b.selectAll('path')
		.datum(datasetA)
		.transition()
		.attr('d', line2)
	
	graph2c.selectAll('path')
		.datum(datasetM)
		.transition()
		.attr('d', line2)
		
	
		}
	})
	
//Dispatch//Graph 5: Infections by Strain	
dispatch.on('graph.five', function(filteredH,filteredA,filteredM,clicked){
if (clicked !== 5){

var sharedHumanL = makeShareData(filteredH)
var sharedAvianL = makeShareData(filteredA)
var sharedMammalL = makeShareData(filteredM)
var excludeHumanL = makeExclude(filteredH)
var excludeAvianL = makeExclude(filteredA)
var excludeMammalL = makeExclude(filteredM)

var datasetHS = graph5Stats(sharedHumanL)
var datasetAS = graph5Stats(sharedAvianL)
var datasetMS = graph5Stats(sharedMammalL)
var datasetHE = graph5Stats(excludeHumanL)
var datasetAE = graph5Stats(excludeAvianL)
var datasetME = graph5Stats(excludeMammalL)

	graph5a.selectAll("rect")
		.data(datasetH)
		//.enter()
		.transition()
		.attr('y', function (d) { 
					return yScale5(d.Count);
					})
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','black')
		.attr('stroke','red')
		.style('opacity',1)
		
	graph5a.selectAll("rect")
		.data(datasetH)
		.exit().remove()
		 
		
	graph5b.selectAll("rect")
		.data(datasetA)
		//.enter()
		.transition()
		.attr('y', function (d) { 
					return yScale5(d.Count); 
					})
		.attr('height', function (d) { 
					return 201 - yScale5(d.Count);
					})
		.attr('fill','red')
		.attr('stroke','black')
		.style('opacity',1)
		
	graph5b.selectAll("rect")
		.data(datasetH)
		.exit().remove()
	
		}
	})
})
})
})
})
/*
References
Place markers:
http://stackoverflow.com/questions/21397608/put-markers-to-a-map-generated-with-topojson-and-d3-js
Delay markers: 
http://website.education.wisc.edu/~swu28/d3t/concept.html
State ids:
https://gist.github.com/mbostock/4090846#file-us-state-names-tsv
Scrubbing & brushing intercation:
http://flowingdata.com/2014/10/15/linked-small-multiples/
Bootstrap:
https://www.youtube.com/watch?v=gqOEoUR5RHg&ab_channel=DerekBanas
*/
	</script>
	
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>

</html>
